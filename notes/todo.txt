notes pour la gestion des lignes déjà existantes.

    erreur à gérer sur les lignes déjà existantes:

    exception de contrainte d'unicité:
    Doctrine\DBAL\Exception\UniqueConstraintViolationException

    ATTENTION
        c'est le flush qui déclenche l'exception, donc pas try catch possible :/
        donc soit on flush à chaque ligne => perf de merde avec sqlite par ex
        soit on s'assure que l'obj existe ou pas avant => double les requetes nécessaires, pas cool

    contrainte:
        le parcours des cartes est très long
        avec sqlite il vaut mieux commit le moins souvent
        si suppr des dep de cartes, les FK doivent etre param pour ne rien faire et laisser à null pour éviter les violations de contraintes

    solutions possibles:
        soit parcours des données et upsert => ça risque d'etre long
            au moins une requete de select pour check si obj existe. l'update devrait etre facultatif si les donées ont pas changées
            à noter que techniquement ça risque d'être chiant
        soit delete de toutes les données et insert à nouveau
            ça lock les tables longtemps
        soit delete au fur et à mesure avant les insertions des différentes entitées
            pendant la maj les données seront incohérentes
        soit insert des données dans tables de travail et au dernier moment replace du contenu des tables de prod par les tables de travail
            extremement relou techniquement je pense
            coute cher en espace disque à priori
            le traitement batch est pas le fort de doctrine et là ça y va clairement

    difficultés
        cibler les entités gérées par doctrine est facile
                x->getName() for x in $this->entityManager->getMetadataFactory()->getAllMetadata()
                et build de la suppression en DQL ou via les obj dédiés
            par contre cibler les tables de jointures auto générées l'est un peu moins (voir impossible?)
            du coup faudrait parcourir ligne par ligne pour suppr les relations => pas possible c'est naze
            donc la solution restante est de faire du sql pur :|
        l'upsert est beaucoup plus compliqué que prévu:
            la récupération des PK d'une entité est possible mais il n'y pas de moyen évident de s'assurer du nom des getters/setters depuis le nom de la prop, et évidemment les propriétés sont private (avec des getters setters qui font que)
            qui plus est il faudra gérer les champs d'associations et ça risque d'etre l'enfer sur terre
